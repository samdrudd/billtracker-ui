<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Bill Tracker</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>

    <script src="./icons/solid.min.js"></script>
    <script src="./icons/fontawesome.min.js"></script>
    <script src="./config.js"></script>
    <script src="./api.js"></script>
    <script src="./models/TransactionModel.js"></script>
    <script src="./views/TransactionListView.js"></script>
    <script src="./views/TransactionView.js"></script>
    <script src="./controllers/TransactionController.js"></script>
</head>
<body>
    <header>
        <h1>Upcoming Transactions for <span id="date-backward" class="date-button" onClick="dateBackward()"><i class="fa-solid fa-chevron-left"></i></span><span id="header-date"></span><span id="date-forward" class="date-button" onClick="dateForward()"><i class="fa-solid fa-chevron-right"></i></span></h1>
    </header>
    <main>
        <div id="transactionModalContainer" class="modal fade">
            <div class="modal-dialog">
                <div id="transactionContainer" class="modal-content">

                </div>
            </div>
        </div>
        <div id="transactionsContainer"></div>
    </main>
    <footer>
        <input type="hidden" id="dateMonth" value="">
        <input type="hidden" id="dateYear" value="">
    </footer>
    <script>
        const transactionModel = new TransactionModel();
        const transactionListView = new TransactionListView("transactionsContainer");
        const transactionView = new TransactionView("transactionContainer", "transactionModalContainer");
        const transactionController = new TransactionController(transactionModel);

        transactionModel.addListObserver(transactionListView);
        transactionModel.addSingleObserver(transactionView);

        var dateBackward = function() {
            var currentDate = moment().date(1).month($('#dateMonth').val()).year($('#dateYear').val());
            var newDate = currentDate.subtract(1, 'month');
            updateHeaderDate(newDate.month(), newDate.year());
        }

        var dateForward = function() {
            var currentDate = moment().date(1).month($('#dateMonth').val()).year($('#dateYear').val());
            var newDate = currentDate.add(1, 'month');
            updateHeaderDate(newDate.month(), newDate.year());
        }

        var updateHeaderDate = function(month, year) {
            $('#dateMonth').val(month);
            $('#dateYear').val(year);
            $('#header-date').text(moment().date(1).month(month).year(year).format("MMMM YYYY"));
            transactionController.changeDate(month, year);
        }

        var selectTransaction = function(transactionId) {
            transactionController.selectTransaction(transactionId);
        }

        $(document).ready(function() {
            updateHeaderDate(moment().month(), moment().year());          
            transactionController.getAll();
        });
    </script>
</body>
</html>